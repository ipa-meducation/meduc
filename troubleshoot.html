<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Troubleshoot Helper - mEducation Hub</title>
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            --primary-green: #49ac57;
            --dark-green: #155240;
            --light-blue: #84d0d4;
            --dark-blue: #2b4085;
            --orange: #f26529;
            --light-gray: #f1f2f2;
            --dark-gray: #414042;
            --charcoal: #414042;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--dark-green) 50%, var(--dark-blue) 100%);
            min-height: 100vh;
            overflow-x: hidden;
            color: var(--charcoal);
        }

        /* Background pattern matching homepage */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            opacity: 0.1;
            background-image: radial-gradient(circle at 25% 25%, rgba(255,255,255,0.2) 1px, transparent 1px),
                              radial-gradient(circle at 75% 75%, rgba(255,255,255,0.15) 1px, transparent 1px);
            background-size: 50px 50px;
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header-section {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        .internal-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 20px;
            animation: subtleGlow 3s ease-in-out infinite alternate;
        }

        @keyframes subtleGlow {
            from { box-shadow: 0 0 10px rgba(255, 255, 255, 0.15); }
            to { box-shadow: 0 0 15px rgba(255, 255, 255, 0.25); }
        }

        h1 {
            color: white;
            font-size: clamp(2rem, 4vw, 2.8rem);
            margin-bottom: 15px;
            font-weight: 700;
            letter-spacing: -1px;
            text-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            line-height: 1.2;
        }

        .back-btn {
            position: absolute;
            top: 10px;
            right: 0;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .chat-container {
            flex: 1;
            background: rgba(255, 255, 255, 0.97);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-height: 600px;
        }

        .chat-header {
            background: linear-gradient(135deg, var(--dark-blue), #3f51b5);
            color: white;
            padding: 20px 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
            overflow: hidden;
        }

        .chat-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            animation: headerShine 4s ease-in-out infinite;
        }

        @keyframes headerShine {
            0%, 100% { transform: rotate(45deg) translateX(-100%); }
            50% { transform: rotate(45deg) translateX(100%); }
        }

        .chat-header i {
            font-size: 1.4rem;
            position: relative;
            z-index: 1;
        }

        .chat-header-text {
            position: relative;
            z-index: 1;
        }

        .chat-header-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 2px;
        }

        .chat-header-subtitle {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .chat-messages {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-height: 500px;
            scrollbar-width: thin;
            scrollbar-color: var(--light-blue) transparent;
        }

        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: transparent;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: var(--light-blue);
            border-radius: 3px;
        }

        .message {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            animation: messageSlide 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .message.bot {
            flex-direction: row;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            flex-shrink: 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .message.bot .message-avatar {
            background: linear-gradient(135deg, var(--dark-blue), #3f51b5);
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, var(--dark-blue), #3f51b5);
        }

        .message-content {
            background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
            padding: 16px 20px;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            max-width: 75%;
            word-wrap: break-word;
            border: 1px solid rgba(0, 0, 0, 0.04);
        }

        .message.bot .message-content {
            border-bottom-left-radius: 6px;
            margin-right: auto;
        }

        .message.user .message-content {
            background: linear-gradient(145deg, var(--light-blue), #7cc5c9);
            color: white;
            border-bottom-right-radius: 6px;
            margin-left: auto;
        }

        .chat-input {
            padding: 25px;
            background: linear-gradient(145deg, #f8f9fa 0%, #ffffff 100%);
            border-top: 1px solid rgba(0, 0, 0, 0.06);
        }

        .topic-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 15px 0;
        }

        .topic-btn {
            background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
            border: 1px solid rgba(0, 0, 0, 0.06);
            padding: 20px;
            border-radius: 18px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: center;
            gap: 15px;
            text-align: left;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
            position: relative;
            overflow: hidden;
        }

        .topic-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--dark-blue), #3f51b5);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .topic-btn:hover::before {
            transform: scaleX(1);
        }

        .topic-btn:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 15px 40px rgba(43, 64, 133, 0.15);
        }

        .topic-btn-icon {
            width: 45px;
            height: 45px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--dark-blue), #3f51b5);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            color: white;
            flex-shrink: 0;
        }

        .topic-btn-content h3 {
            color: var(--dark-green);
            margin-bottom: 5px;
            font-size: 1.1rem;
        }

        .topic-btn-content p {
            color: var(--charcoal);
            opacity: 0.7;
            font-size: 0.85rem;
            line-height: 1.4;
        }

        .topic-btn.pending {
            background: linear-gradient(145deg, var(--light-gray), #e6e7e7);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .topic-btn.pending::before {
            background: var(--dark-gray);
        }

        .topic-btn.pending:hover {
            transform: none;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
        }

        .topic-btn.pending .topic-btn-icon {
            background: linear-gradient(135deg, var(--dark-gray), #757575);
        }

        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: flex-start;
            margin: 15px 0;
        }

        .option-btn {
            background: linear-gradient(145deg, var(--light-blue), #7cc5c9);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(132, 208, 212, 0.3);
            position: relative;
            overflow: hidden;
        }

        .option-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }

        .option-btn:hover::before {
            left: 100%;
        }

        .option-btn:hover {
            background: linear-gradient(145deg, var(--dark-blue), #1e2f5a);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(43, 64, 133, 0.4);
        }

        .back-btn-chat {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            color: var(--dark-green);
            border: 2px solid var(--primary-green);
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 15px rgba(73, 172, 87, 0.2);
            position: relative;
            overflow: hidden;
            min-width: 110px;
            justify-content: center;
        }

        .back-btn-chat i {
            font-size: 1rem;
            transition: transform 0.3s ease;
        }

        .back-btn-chat::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(73, 172, 87, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .back-btn-chat:hover::before {
            left: 100%;
        }

        .back-btn-chat:hover {
            background: linear-gradient(145deg, var(--primary-green), var(--dark-green));
            color: white;
            border-color: var(--dark-green);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(73, 172, 87, 0.4);
        }

        .back-btn-chat:hover i {
            transform: translateX(-3px);
        }

        .restart-btn {
            background: linear-gradient(145deg, var(--primary-green), var(--dark-green));
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 15px rgba(73, 172, 87, 0.3);
            position: relative;
            overflow: hidden;
        }

        .restart-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }

        .restart-btn:hover::before {
            left: 100%;
        }

        .restart-btn:hover {
            background: linear-gradient(145deg, var(--dark-green), #155240);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(73, 172, 87, 0.5);
        }

        .solution-box {
            background: linear-gradient(145deg, #e8f5e8, #d4edda);
            border: 2px solid var(--primary-green);
            border-radius: 18px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 8px 30px rgba(73, 172, 87, 0.15);
            position: relative;
            overflow: hidden;
        }

        .solution-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-green), var(--light-blue));
        }

        .solution-title {
            font-weight: 700;
            color: var(--dark-green);
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.15rem;
        }

        .solution-steps {
            list-style: none;
            counter-reset: step-counter;
        }

        .solution-steps li {
            counter-increment: step-counter;
            margin: 15px 0;
            padding-left: 40px;
            position: relative;
            line-height: 1.6;
        }

        .solution-steps li::before {
            content: counter(step-counter);
            position: absolute;
            left: 0;
            top: 2px;
            background: linear-gradient(145deg, var(--primary-green), var(--dark-green));
            color: white;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: bold;
            box-shadow: 0 3px 10px rgba(73, 172, 87, 0.3);
        }

        .typing-indicator {
            display: none;
            align-items: center;
            gap: 8px;
            padding: 15px 25px;
            color: #666;
            font-style: italic;
            background: rgba(248, 249, 250, 0.8);
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--dark-blue);
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { opacity: 0.3; transform: scale(0.8); }
            30% { opacity: 1; transform: scale(1); }
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px 15px;
            }

            .back-btn {
                position: static;
                margin-bottom: 20px;
                align-self: flex-start;
            }

            .topic-selection {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .message-content {
                max-width: 85%;
            }

            .button-group {
                flex-direction: column;
                align-items: stretch;
            }

            .option-btn, .back-btn-chat, .restart-btn {
                width: 100%;
                justify-content: center;
            }

            .chat-messages {
                padding: 20px;
            }

            .chat-input {
                padding: 20px;
            }
        }

        @media (max-width: 480px) {
            .internal-badge {
                padding: 8px 16px;
                font-size: 0.8rem;
            }

            h1 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>
    
    <div class="container">
        <div class="header-section">
            <div class="internal-badge">
                🤖 Tech Support
            </div>
            <h1>Troubleshoot Helper</h1>
            <a href="home.html" class="back-btn">
                <i class="fas fa-arrow-left"></i>
                Back to Hub
            </a>
        </div>

        <div class="chat-container">
            <div class="chat-header">
                <i class="fas fa-robot"></i>
                <div class="chat-header-text">
                    <div class="chat-header-title">mEducation Assistant</div>
                    <div class="chat-header-subtitle">Ready to help with technical issues</div>
                </div>
                <div style="margin-left: auto; font-size: 0.9rem; position: relative; z-index: 1;">
                    <i class="fas fa-circle" style="color: #4CAF50; font-size: 0.6rem;"></i>
                    Online
                </div>
            </div>

            <div class="chat-messages" id="chatMessages">
                <!-- Messages will be added here dynamically -->
            </div>

            <div class="typing-indicator" id="typingIndicator">
                <i class="fas fa-robot"></i>
                <span>Assistant is typing</span>
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            </div>

            <div class="chat-input" id="chatInput">
                <!-- Input options will be added here dynamically -->
            </div>
        </div>
    </div>

    <script>
        class TroubleshootChatbot {
            constructor() {
                this.messagesContainer = document.getElementById('chatMessages');
                this.inputContainer = document.getElementById('chatInput');
                this.typingIndicator = document.getElementById('typingIndicator');
                this.currentFlow = null;
                this.conversationHistory = [];
                this.navigationStack = [];
                
                this.init();
            }

            init() {
                this.showWelcomeMessage();
                this.showTopicSelection();
            }

            showWelcomeMessage() {
                this.addBotMessage(
                    "👋 Hi! I'm your mEducation Tech Support Assistant. I'm here to help you resolve common technical issues with SurveyCTO and related tools.",
                    false
                );
                
                setTimeout(() => {
                    this.addBotMessage(
                        "Please select the issue you're experiencing from the options below:",
                        false
                    );
                }, 1000);
            }

            showTopicSelection() {
                const topics = [
                    { 
                        id: 'messenger_call', 
                        title: 'Make a Call via Messenger', 
                        icon: 'fas fa-phone',
                        description: 'Learn how to contact learners through messenger',
                        available: true
                    },
                    { 
                        id: 'add_number', 
                        title: 'Add a New Number', 
                        icon: 'fas fa-plus-circle',
                        description: 'Add new contact numbers to your system',
                        available: true
                    },
                    { 
                        id: 'verify_forms', 
                        title: 'Verify Form Submission', 
                        icon: 'fas fa-check-circle',
                        description: 'Check if your forms have been submitted successfully',
                        available: true
                    },
                    { 
                        id: 'blank_form', 
                        title: 'Get a Blank Form', 
                        icon: 'fas fa-file-alt',
                        description: 'Access and download blank forms',
                        available: false
                    },
                    { 
                        id: 'assigned_cases', 
                        title: 'See Assigned Cases', 
                        icon: 'fas fa-tasks',
                        description: 'View your assigned cases and tasks',
                        available: false
                    }
                ];

                const topicButtons = topics.map(topic => {
                    if (topic.available) {
                        return `<button class="topic-btn" onclick="chatbot.startFlow('${topic.id}')">
                            <div class="topic-btn-icon">
                                <i class="${topic.icon}"></i>
                            </div>
                            <div class="topic-btn-content">
                                <h3>${topic.title}</h3>
                                <p>${topic.description}</p>
                            </div>
                        </button>`;
                    } else {
                        return `<button class="topic-btn pending" disabled>
                            <div class="topic-btn-icon">
                                <i class="${topic.icon}"></i>
                            </div>
                            <div class="topic-btn-content">
                                <h3>${topic.title}</h3>
                                <p>Workflow pending - Coming soon!</p>
                            </div>
                        </button>`;
                    }
                }).join('');

                this.inputContainer.innerHTML = `
                    <div class="topic-selection">
                        ${topicButtons}
                    </div>
                `;
                
                this.navigationStack.push({ type: 'topic_selection' });
            }

            startFlow(flowId) {
                this.currentFlow = flowId;
                
                // Add user selection as a message
                const topics = {
                    'messenger_call': 'Make a Call via Messenger',
                    'add_number': 'Add a New Number',
                    'verify_forms': 'Verify Form Submission'
                };
                
                this.addUserMessage(topics[flowId]);
                
                // Start the appropriate flow
                setTimeout(() => {
                    switch(flowId) {
                        case 'messenger_call':
                            this.messengerCallFlow();
                            break;
                        case 'add_number':
                            this.addNumberFlow();
                            break;
                        case 'verify_forms':
                            this.verifyFormsFlow();
                            break;
                    }
                }, 500);
            }

            messengerCallFlow() {
                this.addBotMessage("Do you want to make a call via messenger?");
                this.showOptions([
                    { text: "Yes", action: () => this.messengerCallYes() },
                    { text: "No", action: () => this.messengerCallNo() }
                ]);
                this.navigationStack.push({ type: 'messenger_call_start' });
            }

            messengerCallYes() {
                this.addUserMessage("Yes");
                this.showTyping(() => {
                    this.addBotMessage("Great! Let me guide you through the process:");
                    this.addBotMessage(`
                        <div class="solution-box">
                            <div class="solution-title">
                                <i class="fas fa-list-ol"></i>
                                Steps to Make a Call via Messenger
                            </div>
                            <ol class="solution-steps">
                                <li>Open "Manage Cases"</li>
                                <li>Choose the case/learner</li>
                                <li>Swipe until you reach the section of "Case Information"</li>
                            </ol>
                        </div>
                    `);
                    
                    setTimeout(() => {
                        this.addBotMessage("Can you see the 'Messenger account'?");
                        this.showOptions([
                            { text: "Yes", action: () => this.messengerAccountYes() },
                            { text: "No", action: () => this.messengerAccountNo() }
                        ]);
                        this.navigationStack.push({ type: 'messenger_account_check' });
                    }, 1000);
                });
            }

            messengerCallNo() {
                this.addUserMessage("No");
                this.showTyping(() => {
                    this.addBotMessage("No problem! You can use SurveyCTO to make calls directly.");
                    this.addBotMessage(`
                        <div class="solution-box">
                            <div class="solution-title">
                                <i class="fas fa-phone"></i>
                                Alternative: Call via SurveyCTO
                            </div>
                            <p>You can make calls directly through the SurveyCTO platform using the calling feature.</p>
                        </div>
                    `);
                    this.showRestartOption();
                });
            }

            messengerAccountYes() {
                this.addUserMessage("Yes");
                this.showTyping(() => {
                    this.addBotMessage("Perfect! Here's how to proceed:");
                    this.addBotMessage(`
                        <div class="solution-box">
                            <div class="solution-title">
                                <i class="fas fa-check-circle"></i>
                                Making the Messenger Call
                            </div>
                            <ol class="solution-steps">
                                <li>Go to your messenger and type the messenger account of the guardian/parent</li>
                                <li>Call the messenger account</li>
                                <li>Go back to the SurveyCTO and proceed as is. No need to call via phone call</li>
                                <li>Mark form as finalized once the call is done and submit the form</li>
                            </ol>
                        </div>
                    `);
                    this.showRestartOption();
                });
            }

            messengerAccountNo() {
                this.addUserMessage("No");
                this.showTyping(() => {
                    this.addBotMessage("The learner has no messenger account available. You'll need to use alternative contact methods.");
                    this.showRestartOption();
                });
            }

            addNumberFlow() {
                this.addBotMessage("Do you want to add a new number?");
                this.showOptions([
                    { text: "Yes", action: () => this.addNumberYes() },
                    { text: "No", action: () => this.addNumberNo() }
                ]);
                this.navigationStack.push({ type: 'add_number_start' });
            }

            addNumberYes() {
                this.addUserMessage("Yes");
                this.showTyping(() => {
                    this.addBotMessage("I'll help you add a new number. First, let's start:");
                    this.addBotMessage(`
                        <div class="solution-box">
                            <div class="solution-title">
                                <i class="fas fa-list-ol"></i>
                                Initial Steps
                            </div>
                            <ol class="solution-steps">
                                <li>Open "Manage Cases"</li>
                                <li>Choose the case/learner</li>
                                <li>Swipe until you reach the section of "Calling"</li>
                            </ol>
                        </div>
                    `);
                    
                    setTimeout(() => {
                        this.addBotMessage("Can you see the option 'Answered by someone else'?");
                        this.showOptions([
                            { text: "Yes", action: () => this.answeredBySomeoneYes() },
                            { text: "No", action: () => this.answeredBySomeoneNo() }
                        ]);
                        this.navigationStack.push({ type: 'answered_by_someone_check' });
                    }, 1000);
                });
            }

            addNumberNo() {
                this.addUserMessage("No");
                this.showTyping(() => {
                    this.addBotMessage("That's fine! You can call the existing number for your case.");
                    this.showRestartOption();
                });
            }

            answeredBySomeoneYes() {
                this.addUserMessage("Yes");
                this.showTyping(() => {
                    this.addBotMessage("Great! Here's how to add the new number:");
                    this.addBotMessage(`
                        <div class="solution-box">
                            <div class="solution-title">
                                <i class="fas fa-plus-circle"></i>
                                Adding New Number Steps
                            </div>
                            <ol class="solution-steps">
                                <li>Choose "Answered by someone else", then swipe</li>
                                <li>Choose "Yes, there is a better number to reach the respondent - UPDATE Contacts"</li>
                                <li>Swipe, then add the new number</li>
                                <li>Swipe and type the name and relationship to the student (e.g., Juan, Father)</li>
                                <li>Once all steps are completed, mark the form as finalized and send it</li>
                            </ol>
                        </div>
                    `);
                    this.showRestartOption();
                });
            }

            answeredBySomeoneNo() {
                this.addUserMessage("No");
                this.showTyping(() => {
                    this.addBotMessage("Let me help you find it. Please repeat Step 3 of the previous process - swipe until you reach the 'Calling' section and look for the 'Answered by someone else' option.");
                    this.showRestartOption();
                });
            }

            verifyFormsFlow() {
                this.addBotMessage("Did you recently send forms?");
                this.showOptions([
                    { text: "Yes", action: () => this.recentlySentYes() },
                    { text: "No", action: () => this.recentlySentNo() }
                ]);
                this.navigationStack.push({ type: 'verify_forms_start' });
            }

            recentlySentYes() {
                this.addUserMessage("Yes");
                this.showTyping(() => {
                    this.addBotMessage("Let me help you check your form submissions:");
                    this.addBotMessage(`
                        <div class="solution-box">
                            <div class="solution-title">
                                <i class="fas fa-search"></i>
                                Check Sent Forms
                            </div>
                            <ol class="solution-steps">
                                <li>Go to "Send Finalized Forms"</li>
                            </ol>
                        </div>
                    `);
                    
                    setTimeout(() => {
                        this.addBotMessage("Do you see any form?");
                        this.showOptions([
                            { text: "Yes", action: () => this.seeFormYes() },
                            { text: "No", action: () => this.seeFormNo() }
                        ]);
                        this.navigationStack.push({ type: 'see_form_check' });
                    }, 1000);
                });
            }

            recentlySentNo() {
                this.addUserMessage("No");
                this.showTyping(() => {
                    this.addBotMessage("Let's check if there are any pending forms:");
                    this.addBotMessage(`
                        <div class="solution-box">
                            <div class="solution-title">
                                <i class="fas fa-search"></i>
                                Check for Forms
                            </div>
                            <ol class="solution-steps">
                                <li>Go to "Manage Cases" and click the target case/learner</li>
                            </ol>
                        </div>
                    `);
                    
                    setTimeout(() => {
                        this.addBotMessage("Do you see a form in red texts?");
                        this.showOptions([
                            { text: "Yes", action: () => this.redTextFormYes() },
                            { text: "No", action: () => this.redTextFormNo() }
                        ]);
                        this.navigationStack.push({ type: 'red_text_form_check' });
                    }, 1000);
                });
            }

            seeFormYes() {
                this.addUserMessage("Yes");
                this.showTyping(() => {
                    this.addBotMessage("Perfect! Here's how to send your forms:");
                    this.addBotMessage(`
                        <div class="solution-box">
                            <div class="solution-title">
                                <i class="fas fa-paper-plane"></i>
                                Send Forms
                            </div>
                            <ol class="solution-steps">
                                <li>Toggle all</li>
                                <li>Click "Send selected"</li>
                            </ol>
                        </div>
                    `);
                    this.showRestartOption();
                });
            }

            seeFormNo() {
                this.addUserMessage("No");
                this.showTyping(() => {
                    this.addBotMessage("✅ All forms have been sent! Your submissions are complete.");
                    this.showRestartOption();
                });
            }

            redTextFormYes() {
                this.addUserMessage("Yes");
                this.showTyping(() => {
                    this.addBotMessage("Red text indicates an incomplete form. Here's what to do:");
                    this.addBotMessage(`
                        <div class="solution-box">
                            <div class="solution-title">
                                <i class="fas fa-edit"></i>
                                Complete the Form
                            </div>
                            <ol class="solution-steps">
                                <li>Open the form in red texts</li>
                                <li>Click "Go to end"</li>
                                <li>Tick "Mark form as finalized"</li>
                                <li>Save form and exit</li>
                            </ol>
                        </div>
                    `);
                    this.showRestartOption();
                });
            }

            redTextFormNo() {
                this.addUserMessage("No");
                this.showTyping(() => {
                    this.addBotMessage("✅ All forms have been sent! Your submissions are complete.");
                    this.showRestartOption();
                });
            }

            blankFormFlow() {
                this.addBotMessage("This feature is under development. The workflow for getting blank forms is being created.");
                this.showRestartOption();
            }

            assignedCasesFlow() {
                this.addBotMessage("This feature is under development. The workflow for viewing assigned cases is being created.");
                this.showRestartOption();
            }

            showOptions(options) {
                const buttons = options.map(option => 
                    `<button class="option-btn" onclick="${option.action.toString().replace('() => ', '').replace('this.', 'chatbot.')}">${option.text}</button>`
                ).join('');
                
                const backButton = this.navigationStack.length > 1 ? 
                    '<button class="back-btn-chat" onclick="chatbot.goBack()"><i class="fas fa-arrow-left"></i> Back</button>' : '';
                
                this.inputContainer.innerHTML = `
                    <div class="button-group">
                        ${backButton}
                        ${buttons}
                    </div>
                `;
            }

            showRestartOption() {
                setTimeout(() => {
                    this.addBotMessage("Is there anything else I can help you with?");
                    const backButton = this.navigationStack.length > 1 ? 
                        '<button class="back-btn-chat" onclick="chatbot.goBack()"><i class="fas fa-arrow-left"></i> Back</button>' : '';
                    
                    this.inputContainer.innerHTML = `
                        <div class="button-group">
                            ${backButton}
                            <button class="restart-btn" onclick="chatbot.restart()">
                                <i class="fas fa-refresh"></i> Start Over
                            </button>
                        </div>
                    `;
                }, 1000);
            }

            goBack() {
                if (this.navigationStack.length > 1) {
                    this.navigationStack.pop();
                    const previousStep = this.navigationStack[this.navigationStack.length - 1];
                    
                    const messages = this.messagesContainer.children;
                    if (messages.length >= 2) {
                        messages[messages.length - 1].remove();
                        messages[messages.length - 1].remove();
                    }
                    
                    switch (previousStep.type) {
                        case 'topic_selection':
                            this.showTopicSelection();
                            break;
                        case 'messenger_call_start':
                            this.messengerCallFlow();
                            break;
                        case 'add_number_start':
                            this.addNumberFlow();
                            break;
                        case 'verify_forms_start':
                            this.verifyFormsFlow();
                            break;
                        case 'messenger_account_check':
                            this.showOptions([
                                { text: "Yes", action: () => this.messengerAccountYes() },
                                { text: "No", action: () => this.messengerAccountNo() }
                            ]);
                            break;
                        case 'answered_by_someone_check':
                            this.showOptions([
                                { text: "Yes", action: () => this.answeredBySomeoneYes() },
                                { text: "No", action: () => this.answeredBySomeoneNo() }
                            ]);
                            break;
                        case 'see_form_check':
                            this.showOptions([
                                { text: "Yes", action: () => this.seeFormYes() },
                                { text: "No", action: () => this.seeFormNo() }
                            ]);
                            break;
                        case 'red_text_form_check':
                            this.showOptions([
                                { text: "Yes", action: () => this.redTextFormYes() },
                                { text: "No", action: () => this.redTextFormNo() }
                            ]);
                            break;
                    }
                }
            }

            restart() {
                this.messagesContainer.innerHTML = '';
                this.currentFlow = null;
                this.conversationHistory = [];
                this.navigationStack = [];
                this.showWelcomeMessage();
                setTimeout(() => this.showTopicSelection(), 1500);
            }

            addBotMessage(message, showTyping = true) {
                if (showTyping) {
                    this.showTyping(() => this._addMessage('bot', message));
                } else {
                    this._addMessage('bot', message);
                }
            }

            addUserMessage(message) {
                this._addMessage('user', message);
            }

            _addMessage(sender, message) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${sender}`;
                messageDiv.innerHTML = `
                    <div class="message-avatar">
                        ${sender === 'bot' ? '<i class="fas fa-robot"></i>' : '<i class="fas fa-user"></i>'}
                    </div>
                    <div class="message-content">
                        ${message}
                    </div>
                `;
                
                this.messagesContainer.appendChild(messageDiv);
                this.messagesContainer.scrollTop = this.messagesContainer.scrollHeight;
                
                this.conversationHistory.push({ sender, message, timestamp: new Date() });
            }

            showTyping(callback) {
                this.typingIndicator.style.display = 'flex';
                this.messagesContainer.scrollTop = this.messagesContainer.scrollHeight;
                
                setTimeout(() => {
                    this.typingIndicator.style.display = 'none';
                    callback();
                }, 1500);
            }
        }

        let chatbot;
        document.addEventListener('DOMContentLoaded', function() {
            chatbot = new TroubleshootChatbot();
        });
    </script>
</body>
</html>
